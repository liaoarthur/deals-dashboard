# ─── Lead Scoring Configuration ───────────────────────────────────────────────
# Edit weights and thresholds here without touching code.

# Weight configuration per lead type.
# Each set of weights must sum to 1.0.
# The pipeline normalizes weights if a module doesn't run/returns None.
weights:
  inbound:
    opportunity_size: 0.20
    message_analysis: 0.25
    person_role: 0.35
    specialty_company: 0.20
  product:
    opportunity_size: 0.25
    person_role: 0.45
    specialty_company: 0.30
  event:
    opportunity_size: 0.25
    person_role: 0.45
    specialty_company: 0.30
  other:
    opportunity_size: 0.25
    person_role: 0.45
    specialty_company: 0.30

# ─── Opportunity Size Scoring ─────────────────────────────────────────────────
opportunity_size:
  # Team size from Lead object — most relevant sizing signal.
  # HubSpot enum: JUST_ME(1), TWO_TO_FIVE(3), SIX_TO_TWENTY(13),
  #               TWENTY_ONE_TO_FIFTY(35), FIFTY_ONE_PLUS(75).
  # 21+ is the sweet spot for healthcare orgs. 500+ is handled separately
  # (enterprise flag — person-gated).
  team_size_tiers:
    - { max: 1,     score: 15 }    # JUST_ME
    - { max: 5,     score: 30 }    # TWO_TO_FIVE
    - { max: 20,    score: 50 }    # SIX_TO_TWENTY
    - { max: 50,    score: 70 }    # TWENTY_ONE_TO_FIFTY  (sweet spot starts)
    - { max: 150,   score: 80 }
    - { max: 500,   score: 90 }

  # 500+ team: cap score here unless person is notable (leadership/decision-maker)
  large_team_threshold: 500
  large_team_notable_score: 90
  large_team_default_score: 60

  # Company employee count → score mapping (fallback when team_size unavailable)
  employee_tiers:
    - { max: 10,    score: 20 }
    - { max: 50,    score: 35 }
    - { max: 200,   score: 50 }
    - { max: 1000,  score: 70 }
    - { max: 5000,  score: 85 }
    - { max: 999999, score: 95 }

  # Annual revenue → score mapping (upper bound in USD → score)
  revenue_tiers:
    - { max: 1000000,    score: 20 }
    - { max: 10000000,   score: 40 }
    - { max: 50000000,   score: 60 }
    - { max: 200000000,  score: 80 }
    - { max: 999999999999, score: 95 }

# ─── Person / Role Scoring ────────────────────────────────────────────────────
person_role:
  seniority_scores:
    founder:         95
    clinical_leader: 90
    c_suite:         95
    vp:              80
    director:        70
    manager:         55
    senior:          45
    individual:      30
    unknown:         25

  # Keywords that map to seniority levels (case-insensitive, word-boundary matched).
  # Checked in priority order defined in classify_title():
  #   founder → clinical_leader → c_suite → vp → director → manager → senior → individual
  title_keywords:
    founder:    ["founder", "co-founder", "cofounder", "owner"]
    clinical_leader:
      - "chief medical officer"
      - "chief physician"
      - "chief of surgery"
      - "chief of staff"
      - "chief nursing officer"
      - "chief clinical officer"
      - "medical director"
      - "senior physician"
      - "attending physician"
      - "department head"
      - "cmio"
    c_suite:    ["ceo", "cto", "cfo", "coo", "cro", "chief executive", "chief technology", "chief financial", "chief operating", "chief revenue"]
    vp:         ["vp", "vice president"]
    director:   ["director", "head of"]
    manager:    ["manager", "lead", "team lead"]
    senior:     ["senior", "sr.", "principal", "staff"]
    individual: ["analyst", "associate", "coordinator", "specialist", "engineer", "developer"]

  # Web search importance boosts (applied on top of base seniority score)
  decision_maker_boost: 10
  notable_person_boost: 5
  clinical_leadership_boost: 5

# ─── Specialty & Company Scoring ──────────────────────────────────────────────
specialty_company:
  # Internal weighting: specialty is primary signal, company is secondary
  specialty_weight: 0.6
  company_weight: 0.4

  unknown_specialty_score: 20
  unknown_company_score: 15

  # High-priority medical specialties (score: 90)
  high_priority_score: 90
  high_priority_specialties:
    - "cardiology"
    - "orthopedic"
    - "oncology"
    - "neurology"
    - "neurosurgery"
    - "gastroenterology"
    - "urology"
    - "pulmonology"
    - "endocrinology"
    - "rheumatology"
    - "nephrology"
    - "hematology"
    - "internal medicine"
    - "general surgery"
    - "vascular surgery"
    - "plastic surgery"
    - "dermatology"
    - "ophthalmology"
    - "otolaryngology"
    - "ent"
    - "radiology"
    - "anesthesiology"
    - "emergency medicine"
    - "critical care"
    - "interventional"

  # Medium-priority specialties (score: 65)
  medium_priority_score: 65
  medium_priority_specialties:
    - "family medicine"
    - "family practice"
    - "pediatric"
    - "obstetrics"
    - "gynecology"
    - "ob/gyn"
    - "psychiatry"
    - "pathology"
    - "geriatric"
    - "hospice"
    - "palliative"
    - "sports medicine"
    - "pain management"
    - "allergy"
    - "immunology"
    - "infectious disease"

  # Low-priority specialties — allied health, etc. (score: 35)
  low_priority_score: 35
  low_priority_specialties:
    - "physical therapy"
    - "occupational therapy"
    - "chiropractic"
    - "chiropractor"
    - "acupuncture"
    - "massage therapy"
    - "speech therapy"
    - "audiology"
    - "optometry"
    - "podiatry"
    - "dental"
    - "dentist"
    - "nutrition"
    - "dietitian"
    - "counseling"
    - "social work"

  # Specialty present but not in any list above
  other_specialty_score: 50

  # Company/org scoring via Claude web search
  org_type_scores:
    hospital_system: 90
    academic_medical: 90
    mso_aco_gpo: 85            # management services orgs, ACOs, group purchasing orgs
    physician_group: 70        # includes specialty clinics
    clinic: 60
    allied_health: 35
    healthtech_vendor: 10      # EMR/EHR companies, healthtech SaaS, integration partners
    non_healthcare: 5          # orgs with no healthcare relevance
    unknown: 40
  notable_boost: 10
  large_org_non_notable_cap: 50   # cap for big orgs when person isn't notable
  fallback_company_score: 40

# ─── Contextual Weight Adjustments ──────────────────────────────────────────
# Dynamic adjustments applied to base weights before normalization.
weight_adjustments:
  # Non-notable physician at a large health system → reduce opportunity_size weight
  # (org size inflates opportunity score but a rank-and-file physician can't drive a deal)
  non_notable_physician_opp_size_reduction: 0.10

  # High-intent message (proposal, pricing, procurement) → boost message_analysis weight
  high_intent_message_boost: 0.10
  high_intent_message_threshold: 70

  # Low-intent message (generic "tell me more") → reduce message_analysis weight
  low_intent_message_reduction: 0.10
  low_intent_message_threshold: 40

# ─── Score Floor Guarantees ──────────────────────────────────────────────────
# If a key signal (person_role or message_analysis) is strong enough,
# the composite score is floored to at least B-Monitor regardless of
# how other modules scored.
score_floors:
  person_role_threshold: 70       # person_role >= 70 → composite >= floor
  message_analysis_threshold: 70  # message_analysis >= 70 → composite >= floor
  floor_score: 50                 # B-Monitor minimum

# ─── Inbound Lead Scoring (new 5-criteria system) ────────────────────────
# Used exclusively for lead_type == "inbound". Non-inbound leads use the
# weighted module system above.
inbound_scoring:
  # ── Size scoring (Criterion 1) ─────────────────────────────────────────
  # Maps organization_size enum → 0-100 score.
  # Sweet spots: SIX_TO_TWENTY and TWENTY_ONE_TO_FIFTY.
  size_enum_scores:
    JUST_ME: 15
    TWO_TO_FIVE: 35
    SIX_TO_TWENTY: 80
    TWENTY_ONE_TO_FIFTY: 85
    FIFTY_ONE_PLUS: 65
    FIVEHUNDREDPLUS: 50
    UNKNOWN: 30
  size_no_data_score: 20

  # ── Weights ────────────────────────────────────────────────────────────
  # Base Score = weighted_average(size, message, [company_usage])
  # When company usage data exists:
  weights_with_company:
    size: 0.45
    message: 0.30
    company_usage: 0.25
  # When no company usage data:
  weights_without_company:
    size: 0.55
    message: 0.45
  # When no message either (fallback):
  weights_size_only:
    size: 1.0

  # ── Role scoring (Criterion 2) — boost only ───────────────────────────
  role_boost_leadership: 10
  role_boost_non_leadership: 0
  leadership_keywords:
    - "owner"
    - "founder"
    - "co-founder"
    - "cofounder"
    - "ceo"
    - "cto"
    - "cfo"
    - "coo"
    - "president"
    - "vp"
    - "vice president"
    - "director"
    - "chief"
    - "medical director"
    - "department head"
    - "practice manager"
    - "administrator"
    - "partner"
    - "senior physician"
    - "attending"
    - "department chair"

  # ── Contact product usage (Criterion 4) — boost only ───────────────────
  contact_usage:
    high_sessions: 5         # ≥ this + recent → max boost
    mid_sessions: 2          # ≥ this + recent → mid boost
    recency_days: 30         # "recent" = active within N days
    boost_high: 8
    boost_mid: 6
    boost_low: 3             # any sessions at all

  # ── Company product usage (Criterion 5) — weighted when data exists ────
  company_usage:
    # User count scoring (60% of company usage score)
    user_weight: 0.6
    user_tiers:
      - { min: 10, score: 90 }
      - { min: 5,  score: 75 }
      - { min: 2,  score: 55 }
      - { min: 1,  score: 35 }
    user_default_score: 0
    # Session count scoring (40% of company usage score)
    session_weight: 0.4
    session_tiers:
      - { min: 100, score: 90 }
      - { min: 50,  score: 75 }
      - { min: 20,  score: 60 }
      - { min: 5,   score: 40 }
      - { min: 1,   score: 25 }
    session_default_score: 0

# ─── Tier Classification ─────────────────────────────────────────────────────
# Score thresholds for tier labels. Checked in descending min_score order.
tiers:
  - { label: "A-Priority", min_score: 80 }
  - { label: "B-Monitor",  min_score: 50 }
  - { label: "C-Routine",  min_score: 0  }

# ─── Deduplication ────────────────────────────────────────────────────────────
dedup:
  # Ignore duplicate webhook events for the same lead within this window (seconds)
  window_seconds: 60
